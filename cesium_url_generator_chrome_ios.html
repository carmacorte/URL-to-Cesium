<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cesium Yield URL Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8fbff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 460px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }
    h1 {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .form-label {
      font-weight: 500;
    }
    .tagify__input {
      min-height: 38px;
    }
    button {
      width: 100%;
    }
    .quick-btns .btn {
      margin: 4px 2px;
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ Cesium Yield URL Generator</h1>
    <div class="mb-3">
      <label class="form-label">UUT Types (separados por coma):</label>
      <input id="modelos" placeholder="Selecciona modelos..." class="form-control">
    </div>

    <div class="mb-3">
      <label class="form-label">Business Unit</label>
      <div class="form-check">
        <input class="form-check-input bu" type="radio" name="bu" id="cvebu" value="CVEBU">
        <label class="form-check-label" for="cvebu">CVEBU</label>
      </div>
      <div class="form-check">
        <input class="form-check-input bu" type="radio" name="bu" id="crbu" value="CRBU">
        <label class="form-check-label" for="crbu">CRBU</label>
      </div>
      <div class="form-check">
        <input class="form-check-input bu" type="radio" name="bu" id="tpk" value="TPK">
        <label class="form-check-label" for="tpk">TPK</label>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Location:</label>
      <input id="location" class="form-control" value="FJZ">
    </div>

    <div class="mb-3 row">
      <div class="col">
        <label class="form-label">From Date:</label>
        <input type="date" id="fromDate" class="form-control">
      </div>
      <div class="col">
        <label class="form-label">To Date:</label>
        <input type="date" id="toDate" class="form-control">
      </div>
    </div>

    <div class="quick-btns d-flex flex-wrap mb-3">
      <button class="btn btn-outline-primary" onclick="setDate('hoy')">ğŸ“… Hoy</button>
      <button class="btn btn-outline-primary" onclick="setDate('semana')">ğŸ“… Semana</button>
      <button class="btn btn-outline-primary" onclick="setDate('7dias')">ğŸ” 7 dÃ­as</button>
      <button class="btn btn-outline-primary" onclick="setDate('mes')">ğŸ—“ï¸ Mes</button>
    </div>

    <button class="btn btn-primary mb-2" onclick="generarURL()">ğŸ¯ Generar URL</button>
    <button class="btn btn-secondary mb-2" onclick="copiarURL()">ğŸ“‹ Copiar</button>
    <button class="btn btn-info text-white mb-3" onclick="abrirURL()">ğŸŒ Abrir</button>

    <label class="form-label">Resultado:</label>
    <textarea id="resultado" class="form-control" rows="3" readonly></textarea>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
  <script>
    const modelosPorBU = {
      CVEBU: ["800-110045-01", "800-110945-01"],
      CRBU: ["800-120045-01"],
      TPK: ["800-130045-01", "800-130055-01"]
    };

    const modelosInput = document.querySelector("#modelos");
    const tagify = new Tagify(modelosInput, {
      whitelist: [],
      dropdown: {
        maxItems: 20,
        enabled: 0,
        closeOnSelect: false
      }
    });

    document.querySelectorAll(".bu").forEach(input => {
      input.addEventListener("change", () => {
        const buSeleccionado = input.value;
        const modelos = modelosPorBU[buSeleccionado] || [];
        tagify.removeAllTags();
        tagify.settings.whitelist = modelos;
        tagify.dropdown.show(); // mostrar sugerencias al cambiar
      });
    });

    function setDate(tipo) {
      const hoy = new Date();
      let desde = new Date();
      if (tipo === "semana") {
        const dia = hoy.getDay();
        desde.setDate(hoy.getDate() - (dia === 0 ? 6 : dia - 1));
      } else if (tipo === "7dias") {
        desde.setDate(hoy.getDate() - 6);
      } else if (tipo === "mes") {
        desde.setDate(1);
      }
      const yyyy = hoy.getFullYear();
      const mm = (hoy.getMonth() + 1).toString().padStart(2, '0');
      const dd = hoy.getDate().toString().padStart(2, '0');
      const hoyStr = `${yyyy}-${mm}-${dd}`;

      const yyyyD = desde.getFullYear();
      const mmD = (desde.getMonth() + 1).toString().padStart(2, '0');
      const ddD = desde.getDate().toString().padStart(2, '0');
      const desdeStr = `${yyyyD}-${mmD}-${ddD}`;

      document.getElementById("fromDate").value = desdeStr;
      document.getElementById("toDate").value = hoyStr;
    }

    function generarURL() {
      const modelos = tagify.value.map(tag => tag.value).join(",");
      const location = document.getElementById("location").value;
      const from = document.getElementById("fromDate").value;
      const to = document.getElementById("toDate").value;

      if (!modelos || !from || !to || !location) {
        alert("Completa todos los campos.");
        return;
      }

      const url = `https://cesium.cisco.com/ccc/yield.html?uutType=${modelos}&location=${location}&fromDate=${from}&toDate=${to}`;
      document.getElementById("resultado").value = url;
    }

    function copiarURL() {
      const resultado = document.getElementById("resultado");
      resultado.select();
      document.execCommand("copy");
    }

    function abrirURL() {
      const url = document.getElementById("resultado").value;
      if (url) window.open(url, "_blank");
    }
  </script>
</body>
</html>