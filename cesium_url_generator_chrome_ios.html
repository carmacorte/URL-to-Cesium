<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cesium Yield Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="font-family:sans-serif;max-width:500px;margin:auto;padding:20px">
  <h2>ğŸ”— Cesium Lookup Generator</h2>

  <label>UUT Types (coma):</label><br>
  <input type="text" id="uut" value="800-110045-01,800-110945-01" style="width:100%;font-size:16px"><br><br>

  <label>Location:</label><br>
  <input type="text" id="loc" value="FJZ" style="width:100%;font-size:16px"><br><br>

  <label>From Date:</label><br>
  <input type="date" id="start" value="2025-07-16" style="width:100%;font-size:16px"><br><br>

  <label>To Date:</label><br>
  <input type="date" id="end" value="2025-07-16" style="width:100%;font-size:16px"><br><br>

  <button onclick="generateURL()" style="width:100%;font-size:18px;padding:10px">ğŸ¯ Generar URL</button><br><br>

  <div style="font-size:16px">
    <strong>Resultado:</strong><br>
    <textarea id="result" rows="4" style="width:100%;font-size:14px" readonly></textarea><br><br>
    <button onclick="copyToClipboard()" style="width:100%;font-size:16px">ğŸ“‹ Copiar URL</button><br><br>
    <a id="openLink" href="#" target="_blank" style="display:none;color:blue;font-size:16px">ğŸ”— Abrir URL en nueva pestaÃ±a</a><br><br>
  </div>

  <button onclick="startAlerts()" style="width:100%;font-size:16px;background-color:#dff0d8">ğŸ• Activar alerta cada hora</button><br><br>
  <button onclick="stopAlerts()" style="width:100%;font-size:16px;background-color:#f2dede">â›” Detener alerta</button>

  <script>
    let alertIntervalId = null;
    let latestURL = "";

    function generateURL() {
      const uut = document.getElementById("uut").value;
      const loc = document.getElementById("loc").value;
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;
      const base = "https://cesium.cisco.com/apps/PolarisSearch/AdvanceYield";

      latestURL = base + "?SI=" + encodeURIComponent(uut) + "," + loc +
                  "&SD=" + start +
                  "&ED=" + end +
                  "&datetype=nodate&yieldtype=firstpass&yielddatetype=rectime" +
                  "&uuttype=" + encodeURIComponent(uut) +
                  "&location=" + loc +
                  "&timezone=US%2FMountain";

      document.getElementById("result").value = latestURL;
      const link = document.getElementById("openLink");
      link.href = latestURL;
      link.style.display = "inline";
      link.textContent = "ğŸ”— Abrir URL en nueva pestaÃ±a";
    }

    function copyToClipboard() {
      const resultBox = document.getElementById("result");
      resultBox.select();
      resultBox.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("URL copiada al portapapeles ğŸ“‹");
    }

    function startAlerts() {
      if (alertIntervalId) {
        alert("ğŸ” Ya estÃ¡ activa la alerta cada hora.");
        return;
      }
      alert("âœ… Se activarÃ¡ un aviso cada hora con el Ãºltimo URL generado.");
      alertIntervalId = setInterval(() => {
        if (latestURL) {
          alert("â° RevisiÃ³n de Yield:\n\n" + latestURL);
        } else {
          alert("âš ï¸ No se ha generado un URL todavÃ­a.");
        }
      }, 3600000); // 1 hora = 3600000 ms
    }

    function stopAlerts() {
      if (alertIntervalId) {
        clearInterval(alertIntervalId);
        alertIntervalId = null;
        alert("ğŸ›‘ Alerta detenida.");
      } else {
        alert("â„¹ï¸ No hay alertas activas.");
      }
    }
  </script>
</body>
</html>