<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cesium Yield URL Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell;
      background-color: #f3f6fb;
      padding: 20px;
      margin: 0;
      color: #2e3a59;
    }
    h2 {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 20px;
      color: #1a2b49;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      cursor: pointer;
      font-weight: 500;
      background-color: #2c65c8;
      color: white;
      border: none;
      margin-top: 10px;
    }
    button:hover {
      background-color: #1a4a9e;
    }
    textarea {
      resize: none;
      background-color: #eef3fb;
    }
    .btn-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .checkbox-row {
      margin-top: 10px;
    }
    .checkbox-row label {
      display: block;
      margin-top: 5px;
    }
  </style>
</head>
<body>

<h2>ğŸ”— Cesium Yield URL Generator</h2>

<label for="uutTypes">UUT Types (separados por coma):</label>
<input type="text" id="uutTypes" placeholder="800-110045-01,800-110945-01">

<div class="checkbox-row">
  <label><input type="checkbox" id="cvebuGroup" onclick="toggleGroup('CVEBU')"> CVEBU</label>
  <label><input type="checkbox" id="crbuGroup" onclick="toggleGroup('CRBU')"> CRBU</label>
  <label><input type="checkbox" id="tpkGroup" onclick="toggleGroup('TPK')"> TPK</label>
</div>

<label for="location">Location:</label>
<input type="text" id="location" value="FJZ">

<label for="fromDate">From Date:</label>
<input type="date" id="fromDate">

<label for="toDate">To Date:</label>
<input type="date" id="toDate">

<div class="btn-row">
  <button onclick="generateURL()">ğŸ¯ Generar URL</button>
  <button onclick="copyURL()">ğŸ“‹ Copiar</button>
  <button onclick="openURL()">ğŸŒ Abrir</button>
</div>

<label for="resultURL">Resultado:</label>
<textarea id="resultURL" rows="3" readonly></textarea>

<div class="btn-row">
  <button onclick="startAlerts()">â° Activar alerta cada 5 min</button>
  <button onclick="stopAlerts()">â›” Detener alerta</button>
</div>

<script>
  let latestURL = "";
  let alertIntervalId = null;

  const groups = {
    CVEBU: [
      "800-108480-%", "800-109399-%", "800-110045-%", "800-110945-%",
      "800-112271-%", "800-137504-%", "800-147504-%"
    ],
    CRBU: [
      "80-LC0-36FH", "88-LC0-38FH-M", "8804-FC1", "8808-FC1"
    ],
    TPK: [
      "800-108035-04", "800-108035-05", "800-108036-04",
      "800-108037-04", "800-108038-04", "800-110656-01"
    ]
  };

  function toggleGroup(groupKey) {
    const checkbox = document.getElementById(`${groupKey.toLowerCase()}Group`);
    const current = document.getElementById("uutTypes").value.trim();
    const currentSet = new Set(current ? current.split(",") : []);
    const groupItems = groups[groupKey];

    if (checkbox.checked) {
      groupItems.forEach(item => currentSet.add(item));
    } else {
      groupItems.forEach(item => currentSet.delete(item));
    }

    document.getElementById("uutTypes").value = Array.from(currentSet).join(",");
  }

  function generateURL() {
    const uut = document.getElementById("uutTypes").value.trim();
    const location = document.getElementById("location").value.trim();
    const from = document.getElementById("fromDate").value;
    const to = document.getElementById("toDate").value;

    if (!uut || !from || !to) {
      alert("âš ï¸ Por favor llena todos los campos.");
      return;
    }

    const encodedUUT = encodeURIComponent(uut);
    const encodedLoc = encodeURIComponent(location);

    latestURL = `https://cesium.cisco.com/apps/PolarisSearch/AdvanceYield?SI=${encodedUUT},${encodedLoc}&SD=${from}&ED=${to}&datetype=nodate&yieldtype=firstpass&yielddatetype=rectime&uuttype=${encodedUUT}&location=${encodedLoc}&timezone=US%2FMountain`;

    document.getElementById("resultURL").value = latestURL;
  }

  function copyURL() {
    const urlBox = document.getElementById("resultURL");
    urlBox.select();
    document.execCommand("copy");
    alert("ğŸ“‹ URL copiada al portapapeles.");
  }

  function openURL() {
    if (latestURL) {
      window.open(latestURL, "_blank");
    } else {
      alert("âš ï¸ Genera una URL primero.");
    }
  }

  function startAlerts() {
    if (alertIntervalId) {
      alert("ğŸŸ¦ Ya estÃ¡ activa la alerta.");
      return;
    }

    alert("âœ… Se activarÃ¡ un aviso cada 5 minutos con el URL generado.");
    alertIntervalId = setInterval(() => {
      if (latestURL) {
        const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        alert(`ğŸ•’ RevisiÃ³n de Yield (${now}):\nğŸ”— ${latestURL}`);
      } else {
        alert("âš ï¸ No se ha generado un URL todavÃ­a.");
      }
    }, 5 * 60 * 1000);
  }

  function stopAlerts() {
    if (alertIntervalId) {
      clearInterval(alertIntervalId);
      alertIntervalId = null;
      alert("ğŸ›‘ Alerta detenida.");
    }
  }
</script>

</body>
</html>